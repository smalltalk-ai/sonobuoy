# Sonobuoy Results Client

## Table of Contents

* [Summary](#summary)
* [Objectives](#objectives)
  * [Goals](#goals)
  * [Non-Goals](#non-goals)
* [Proposal](#proposal)
  * [User Stories](#user-stories)
* [Unresolved Questions](#unresolved-questions)

## Summary

Sonobuoy delivers results in a gzipped tar archive. The structure of the tar is
[documented here][tar structure] but programmatic access is up to every consumer
to implement. The structure of the results can change between versions and
consumer implementations become fragile.

This proposal aims to describe a client library to help automate the analysis of
a Sonobuoy result artifact.

## Objectives

Provide a client library for easy access to data found in Sonobuoy results
across sonobuoy and Kubernetes versions.

### Goals

 - Support all result files versions starting at v0.9.0.
 - Provide basic access to kubernetes resources and plugin-generated files.
 - Provide good access to Sonobuoy-generated data.

### Non-Goals

- Manage Kubernetes resource versioning.
- Customize the client library for every plugin written.
- There will be no support for tarballs before Sonobuoy version 0.9.0.

## Proposal

Define a set of functions that gives the consumer access to the underlying data
without exploding memory. See [the struct method definitions][struct] for a full
picture.

### User Stories

#### https://scanner.heptio.com

- Scanner provides a user interface to Sonobuoy Results. It has to read through
  tarballs generated by Sonobuoy and extract files and support multiple tarball
  versions. It should not have to implement this custom logic and should be able
  to leverage this client library.

#### Custom plugin user

- A user has developed a custom plugin and wants an easy way to get the data out
  of the files their plugin has written.

#### Results from various Sonobuy versions

- A user has a collection of results across multiple versions of Sonobuoy and
  wants to read the data without having to worry about the implementation of the
  tarball schema directly.

#### Resource Analysis

- A user wants to analyze what's actually running on their cluster. They will
  need a way to get at the resources that sonobuoy has found.

## Unresolved Questions

* None at this time.

[tar structure]: snapshot.md
[queries]:
https://github.com/vmware-tanzu/sonobuoy/blob/v0.14.0/pkg/discovery/queries.go
[struct]: https://github.com/chuckha/sonobuoy/blob/sep-1/client/
